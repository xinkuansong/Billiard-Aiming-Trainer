<view class="stats-container">
  <!-- 顶部用户信息 -->
  <view class="user-header" wx:if="{{userInfo}}">
    <image class="user-avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill"></image>
    <view class="user-info">
      <text class="user-name">{{userInfo.nickName}}</text>
      <text class="user-title">台球练习者</text>
    </view>
  </view>

  <!-- 标签页导航 -->
  <view class="tab-navigation">
    <view 
      class="tab-item {{currentTab === 'overview' ? 'active' : ''}}"
      data-tab="overview"
      bindtap="switchTab"
    >
      <text>概览</text>
    </view>
    <view 
      class="tab-item {{currentTab === 'detailed' ? 'active' : ''}}"
      data-tab="detailed"
      bindtap="switchTab"
    >
      <text>详细</text>
    </view>
    <view 
      class="tab-item {{currentTab === 'achievements' ? 'active' : ''}}"
      data-tab="achievements"
      bindtap="switchTab"
    >
      <text>成就</text>
    </view>
  </view>

  <!-- 概览标签页 -->
  <view class="tab-content" wx:if="{{currentTab === 'overview'}}">
    <!-- 核心统计数据 -->
    <view class="stats-overview">
      <view class="stat-card">
        <text class="stat-number">{{userStats.totalPractices}}</text>
        <text class="stat-label">总练习次数</text>
      </view>
      <view class="stat-card">
        <text class="stat-number">{{userStats.averageError.toFixed(1)}}°</text>
        <text class="stat-label">平均误差</text>
      </view>
      <view class="stat-card">
        <text class="stat-number">{{userStats.bestStreak}}</text>
        <text class="stat-label">最佳连击</text>
      </view>
    </view>

    <!-- 进度图表 -->
    <view class="chart-section" wx:if="{{chartData.length > 0}}">
      <text class="section-title">最近7天练习情况</text>
      <view class="chart-container">
        <view class="chart-item" wx:for="{{chartData}}" wx:key="date">
          <view class="chart-bar">
            <view class="bar-fill" style="height: {{item.count * 10}}rpx; background: linear-gradient(to top, #4CAF50, #8BC34A);"></view>
          </view>
          <text class="chart-label">{{item.date}}</text>
          <text class="chart-count">{{item.count}}</text>
        </view>
      </view>
    </view>

    <!-- 最近练习记录 -->
    <view class="recent-practices" wx:if="{{recentPractices.length > 0}}">
      <text class="section-title">最近练习记录</text>
      <view class="practice-list">
        <view class="practice-item" wx:for="{{recentPractices}}" wx:key="id">
          <view class="practice-grade grade-{{item.grade}}">{{item.grade}}</view>
          <view class="practice-info">
            <text class="practice-accuracy">准确率: {{item.accuracy.toFixed(1)}}%</text>
            <text class="practice-error">误差: {{item.error.toFixed(1)}}°</text>
          </view>
          <text class="practice-time">{{item.timestamp}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 详细标签页 -->
  <view class="tab-content" wx:if="{{currentTab === 'detailed'}}">
    <view class="detailed-stats">
      <view class="stats-section">
        <text class="section-title">练习分布</text>
        <view class="distribution-chart">
          <view class="distribution-item">
            <text class="distribution-label">S级 (≤2°)</text>
            <view class="distribution-bar">
              <view class="bar-fill" style="width: 60rpx; background: #4CAF50;"></view>
            </view>
            <text class="distribution-count">15次</text>
          </view>
          <view class="distribution-item">
            <text class="distribution-label">A级 (2-5°)</text>
            <view class="distribution-bar">
              <view class="bar-fill" style="width: 80rpx; background: #8BC34A;"></view>
            </view>
            <text class="distribution-count">20次</text>
          </view>
          <view class="distribution-item">
            <text class="distribution-label">B级 (5-10°)</text>
            <view class="distribution-bar">
              <view class="bar-fill" style="width: 40rpx; background: #FFC107;"></view>
            </view>
            <text class="distribution-count">10次</text>
          </view>
          <view class="distribution-item">
            <text class="distribution-label">C级 (10-20°)</text>
            <view class="distribution-bar">
              <view class="bar-fill" style="width: 20rpx; background: #FF9800;"></view>
            </view>
            <text class="distribution-count">5次</text>
          </view>
          <view class="distribution-item">
            <text class="distribution-label">D级 (>20°)</text>
            <view class="distribution-bar">
              <view class="bar-fill" style="width: 10rpx; background: #F44336;"></view>
            </view>
            <text class="distribution-count">2次</text>
          </view>
        </view>
      </view>

      <view class="stats-section">
        <text class="section-title">练习建议</text>
        <view class="suggestions">
          <view class="suggestion-item" wx:if="{{userStats.averageError > 10}}">
            <text class="suggestion-icon">💡</text>
            <text class="suggestion-text">建议多练习基础角度识别，提高准确性</text>
          </view>
          <view class="suggestion-item" wx:if="{{userStats.totalPractices < 20}}">
            <text class="suggestion-icon">📈</text>
            <text class="suggestion-text">增加练习频率，建议每天练习5-10次</text>
          </view>
          <view class="suggestion-item" wx:if="{{userStats.bestStreak < 5}}">
            <text class="suggestion-icon">🎯</text>
            <text class="suggestion-text">专注于连续准确性，培养稳定性</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 成就标签页 -->
  <view class="tab-content" wx:if="{{currentTab === 'achievements'}}">
    <view class="achievements-section">
      <text class="section-title">成就系统</text>
      <view class="achievements-grid">
        <view 
          class="achievement-item {{item.unlocked ? 'unlocked' : 'locked'}}"
          wx:for="{{achievements}}" 
          wx:key="id"
        >
          <text class="achievement-icon">{{item.icon}}</text>
          <text class="achievement-title">{{item.title}}</text>
          <text class="achievement-desc">{{item.desc}}</text>
          <view class="achievement-status" wx:if="{{item.unlocked}}">
            <text class="status-text">已解锁</text>
            <text class="unlock-date">{{item.unlockedAt}}</text>
          </view>
          <view class="achievement-status locked" wx:else>
            <text class="status-text">未解锁</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 底部操作按钮 -->
  <view class="bottom-actions">
    <button class="action-btn secondary" bindtap="exportData">
      <text>导出数据</text>
    </button>
    <button class="action-btn primary" bindtap="shareStats">
      <text>分享成绩</text>
    </button>
    <button class="action-btn danger" bindtap="clearData">
      <text>清除数据</text>
    </button>
  </view>

  <!-- 空状态 -->
  <view class="empty-state" wx:if="{{userStats.totalPractices === 0}}">
    <image class="empty-icon" src="/images/empty.png" mode="aspectFit"></image>
    <text class="empty-title">还没有练习记录</text>
    <text class="empty-desc">开始你的第一次台球瞄准练习吧！</text>
    <navigator url="/pages/index/index" class="start-practice-btn">
      <text>开始练习</text>
    </navigator>
  </view>
</view> 