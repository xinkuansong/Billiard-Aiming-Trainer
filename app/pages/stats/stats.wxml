<view class="stats-container">
  <!-- é¡¶éƒ¨ç”¨æˆ·ä¿¡æ¯ -->
  <view class="user-header" wx:if="{{userInfo}}">
    <image class="user-avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill"></image>
    <view class="user-info">
      <text class="user-name">{{userInfo.nickName}}</text>
      <text class="user-title">å°çƒç»ƒä¹ è€…</text>
    </view>
  </view>

  <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
  <view class="tab-navigation">
    <view 
      class="tab-item {{currentTab === 'overview' ? 'active' : ''}}"
      data-tab="overview"
      bindtap="switchTab"
    >
      <text>æ¦‚è§ˆ</text>
    </view>
    <view 
      class="tab-item {{currentTab === 'detailed' ? 'active' : ''}}"
      data-tab="detailed"
      bindtap="switchTab"
    >
      <text>è¯¦ç»†</text>
    </view>
    <view 
      class="tab-item {{currentTab === 'achievements' ? 'active' : ''}}"
      data-tab="achievements"
      bindtap="switchTab"
    >
      <text>æˆå°±</text>
    </view>
  </view>

  <!-- æ¦‚è§ˆæ ‡ç­¾é¡µ -->
  <view class="tab-content" wx:if="{{currentTab === 'overview'}}">
    <!-- æ ¸å¿ƒç»Ÿè®¡æ•°æ® -->
    <view class="stats-overview">
      <view class="stat-card">
        <text class="stat-number">{{userStats.totalPractices}}</text>
        <text class="stat-label">æ€»ç»ƒä¹ æ¬¡æ•°</text>
      </view>
      <view class="stat-card">
        <text class="stat-number">{{userStats.averageError.toFixed(1)}}Â°</text>
        <text class="stat-label">å¹³å‡è¯¯å·®</text>
      </view>
      <view class="stat-card">
        <text class="stat-number">{{userStats.bestStreak}}</text>
        <text class="stat-label">æœ€ä½³è¿å‡»</text>
      </view>
    </view>

    <!-- è¿›åº¦å›¾è¡¨ -->
    <view class="chart-section" wx:if="{{chartData.length > 0}}">
      <text class="section-title">æœ€è¿‘7å¤©ç»ƒä¹ æƒ…å†µ</text>
      <view class="chart-container">
        <view class="chart-item" wx:for="{{chartData}}" wx:key="date">
          <view class="chart-bar">
            <view class="bar-fill" style="height: {{item.count * 10}}rpx; background: linear-gradient(to top, #4CAF50, #8BC34A);"></view>
          </view>
          <text class="chart-label">{{item.date}}</text>
          <text class="chart-count">{{item.count}}</text>
        </view>
      </view>
    </view>

    <!-- æœ€è¿‘ç»ƒä¹ è®°å½• -->
    <view class="recent-practices" wx:if="{{recentPractices.length > 0}}">
      <text class="section-title">æœ€è¿‘ç»ƒä¹ è®°å½•</text>
      <view class="practice-list">
        <view class="practice-item" wx:for="{{recentPractices}}" wx:key="id">
          <view class="practice-grade grade-{{item.grade}}">{{item.grade}}</view>
          <view class="practice-info">
            <text class="practice-accuracy">å‡†ç¡®ç‡: {{item.accuracy.toFixed(1)}}%</text>
            <text class="practice-error">è¯¯å·®: {{item.error.toFixed(1)}}Â°</text>
          </view>
          <text class="practice-time">{{item.timestamp}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- è¯¦ç»†æ ‡ç­¾é¡µ -->
  <view class="tab-content" wx:if="{{currentTab === 'detailed'}}">
    <view class="detailed-stats">
      <view class="stats-section">
        <text class="section-title">ç»ƒä¹ åˆ†å¸ƒ</text>
        <view class="distribution-chart">
          <view class="distribution-item">
            <text class="distribution-label">Sçº§ (â‰¤2Â°)</text>
            <view class="distribution-bar">
              <view class="bar-fill" style="width: 60rpx; background: #4CAF50;"></view>
            </view>
            <text class="distribution-count">15æ¬¡</text>
          </view>
          <view class="distribution-item">
            <text class="distribution-label">Açº§ (2-5Â°)</text>
            <view class="distribution-bar">
              <view class="bar-fill" style="width: 80rpx; background: #8BC34A;"></view>
            </view>
            <text class="distribution-count">20æ¬¡</text>
          </view>
          <view class="distribution-item">
            <text class="distribution-label">Bçº§ (5-10Â°)</text>
            <view class="distribution-bar">
              <view class="bar-fill" style="width: 40rpx; background: #FFC107;"></view>
            </view>
            <text class="distribution-count">10æ¬¡</text>
          </view>
          <view class="distribution-item">
            <text class="distribution-label">Cçº§ (10-20Â°)</text>
            <view class="distribution-bar">
              <view class="bar-fill" style="width: 20rpx; background: #FF9800;"></view>
            </view>
            <text class="distribution-count">5æ¬¡</text>
          </view>
          <view class="distribution-item">
            <text class="distribution-label">Dçº§ (>20Â°)</text>
            <view class="distribution-bar">
              <view class="bar-fill" style="width: 10rpx; background: #F44336;"></view>
            </view>
            <text class="distribution-count">2æ¬¡</text>
          </view>
        </view>
      </view>

      <view class="stats-section">
        <text class="section-title">ç»ƒä¹ å»ºè®®</text>
        <view class="suggestions">
          <view class="suggestion-item" wx:if="{{userStats.averageError > 10}}">
            <text class="suggestion-icon">ğŸ’¡</text>
            <text class="suggestion-text">å»ºè®®å¤šç»ƒä¹ åŸºç¡€è§’åº¦è¯†åˆ«ï¼Œæé«˜å‡†ç¡®æ€§</text>
          </view>
          <view class="suggestion-item" wx:if="{{userStats.totalPractices < 20}}">
            <text class="suggestion-icon">ğŸ“ˆ</text>
            <text class="suggestion-text">å¢åŠ ç»ƒä¹ é¢‘ç‡ï¼Œå»ºè®®æ¯å¤©ç»ƒä¹ 5-10æ¬¡</text>
          </view>
          <view class="suggestion-item" wx:if="{{userStats.bestStreak < 5}}">
            <text class="suggestion-icon">ğŸ¯</text>
            <text class="suggestion-text">ä¸“æ³¨äºè¿ç»­å‡†ç¡®æ€§ï¼ŒåŸ¹å…»ç¨³å®šæ€§</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æˆå°±æ ‡ç­¾é¡µ -->
  <view class="tab-content" wx:if="{{currentTab === 'achievements'}}">
    <view class="achievements-section">
      <text class="section-title">æˆå°±ç³»ç»Ÿ</text>
      <view class="achievements-grid">
        <view 
          class="achievement-item {{item.unlocked ? 'unlocked' : 'locked'}}"
          wx:for="{{achievements}}" 
          wx:key="id"
        >
          <text class="achievement-icon">{{item.icon}}</text>
          <text class="achievement-title">{{item.title}}</text>
          <text class="achievement-desc">{{item.desc}}</text>
          <view class="achievement-status" wx:if="{{item.unlocked}}">
            <text class="status-text">å·²è§£é”</text>
            <text class="unlock-date">{{item.unlockedAt}}</text>
          </view>
          <view class="achievement-status locked" wx:else>
            <text class="status-text">æœªè§£é”</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæŒ‰é’® -->
  <view class="bottom-actions">
    <button class="action-btn secondary" bindtap="exportData">
      <text>å¯¼å‡ºæ•°æ®</text>
    </button>
    <button class="action-btn primary" bindtap="shareStats">
      <text>åˆ†äº«æˆç»©</text>
    </button>
    <button class="action-btn danger" bindtap="clearData">
      <text>æ¸…é™¤æ•°æ®</text>
    </button>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{userStats.totalPractices === 0}}">
    <image class="empty-icon" src="/images/empty.png" mode="aspectFit"></image>
    <text class="empty-title">è¿˜æ²¡æœ‰ç»ƒä¹ è®°å½•</text>
    <text class="empty-desc">å¼€å§‹ä½ çš„ç¬¬ä¸€æ¬¡å°çƒç„å‡†ç»ƒä¹ å§ï¼</text>
    <navigator url="/pages/index/index" class="start-practice-btn">
      <text>å¼€å§‹ç»ƒä¹ </text>
    </navigator>
  </view>
</view> 